```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
using db = long double;
using i128 = __int128;

ll add(ll x, ll y, ll MOD) { x %= MOD; y %= MOD; return (x + y) % MOD; }
ll mul(ll x, ll y, ll MOD) { x %= MOD; y %= MOD; return (x * y) % MOD; }

const int N = 50000, B = 300;
int n;
int siz, L[B+5], R[B+5], belong[N+5];
ll a[N+5], sum[B+5], tag[B+5];

int main()
{
    ios::sync_with_stdio(0); cin.tie(0); cout.tie(0); 
    cin >> n;
    for (int i = 1; i <= n; ++i) {
        cin >> a[i];
    }

    siz = sqrt(n) + 1;
    for (int i = 1; i <= n; ++i) {
        belong[i] = i / siz + 1;
        sum[belong[i]] += a[i];
        if (belong[i] != belong[i-1]) {
            L[belong[i]] = i;
            R[belong[i-1]] = i - 1;
        }
    }
    L[belong[1]] = 1;
    R[belong[n]] = n;

    for (int i = 1; i <= n; ++i) {
        int o, l, r; ll c;
        cin >> o >> l >> r >> c;
        if (o == 0) {
            if (belong[l] == belong[r]) {
                for (int j = l; j <= r; ++j) {
                    a[j] += c;
                    sum[belong[j]] += c;
                }
            } else {
                for (int j = l; j < L[belong[l]+1]; ++j) {
                    a[j] += c;
                    sum[belong[j]] += c;
                }
                for (int j = L[belong[r]]; j <= r; ++j) {
                    a[j] += c;
                    sum[belong[j]] += c;
                }
                for (int j = belong[l]+1; j < belong[r]; ++j) {
                    sum[j] += c * (R[j] - L[j] + 1);
                    tag[j] += c;
                }
            }
        } else {
            ll ans = 0;
            if (belong[l] == belong[r]) {
                for (int j = l; j <= r; ++j) {
                    ans = add(ans, a[j] + tag[belong[j]], c + 1);
                }
            } else {
                for (int j = l; j < L[belong[l]+1]; ++j) {
                    ans = add(ans, a[j] + tag[belong[j]], c + 1);
                }
                for (int j = L[belong[r]]; j <= r; ++j) {
                    ans = add(ans, a[j] + tag[belong[j]], c + 1);
                }
                for (int j = belong[l]+1; j < belong[r]; ++j) {
                    ans = add(ans, sum[j], c + 1);
                }
            }
            cout << ans << "\n";
        }
    }
}
```
