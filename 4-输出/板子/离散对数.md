```cpp
// https://www.luogu.com.cn/article/svjqhzj5
#include <bits/stdc++.h>
#include <ext/pb_ds/assoc_container.hpp>
#include <ext/pb_ds/hash_policy.hpp>
using namespace std;
using namespace __gnu_pbds;
typedef long long ll;
const int N = 31630;
int qpow(int a, int b, int p) {
	int c = 1;
	while (b) {
		if (b & 1) c = (ll)c * a % p;
		a = (ll)a * a % p, b >>= 1;
	}
	return c;
}
gp_hash_table<int, int> mp;
int p, g, blk, w;
void init(int g, int P, int B) {
	p = P, blk = B, w = qpow(qpow(g, blk, p), p - 2, p);
	int x = 1;
	for (int i = 0; i < blk; i++) mp[x] = i, x = (ll)x * g % p;
}
int BSGS(int a) {
	int x = a, tot = p / blk;
	for (int i = 0; i <= tot; i++) {
		if (mp.find(x) != mp.end()) return i * blk + mp[x];
		x = (ll)x * w % p;
	}
	return -1;
}
int lg_1, lim, tot, pri[N], lg[N];
bool vis[N];
inline int mod(int x, int p) { return x >= p ? x - p : x; }
void sieve(int n) {
	for (int i = 2; i <= n; i++) {
		if (!vis[i]) pri[++tot] = i, lg[i] = BSGS(i);
		for (int j = 1, k; j <= tot && i * pri[j] <= n; j++) {
			k = pri[j];
			vis[i * k] = 1, lg[i * k] = mod(lg[i] + lg[k], p - 1);
			if (!(i % k)) break;
		}
	}
}
int Log(int a) {
	if (a <= lim) return lg[a];
	int b = p / a, c = p % a;
	if (c < a - c) return mod(mod(lg_1 + Log(c), p - 1) - lg[b] + p - 1, p - 1);
	return mod(Log(a - c) - lg[b + 1] + p - 1, p - 1);
}
int main() {
	ios::sync_with_stdio(0);
	cin.tie(0), cout.tie(0);
	cin >> p >> g, lim = sqrt(p) + 1;
	init(g, p, sqrt(p * sqrt(p) / log(p)));
	lg_1 = BSGS(p - 1);
	sieve(lim);
	int T, x;
	cin >> T;
	while (T--) cin >> x, cout << Log(x) << '\n';
}
```