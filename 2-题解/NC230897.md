---
tags:
  - 题解
  - 生成函数
aliases:
  - Blocks
---
## [NC230897. Blocks](https://ac.nowcoder.com/acm/problem/230897)

构造指数生成函数 $F(x)=\displaystyle\sum_{n\ge0} \dfrac{x^n}{n!}$ 和 $G(x)=\displaystyle\sum_{n\ge0} \dfrac{x^{2n}}{(2n)!}$
涂色方案对应的生成函数为 $H(x)=F^2(x)G^2(x)$，$[x^n]H(x)$ 即为所求
$F(x)=\exp(x)$，考虑如何表示 $G(x)$
构造一个正负开关 $(-1)^n$，用 $1+(-1)^n$ 就可以构造出 $2,0,2,0,\ldots$ 的序列，除以 $2$ 就得到了 $G$ 的系数
$$G(x)=\dfrac{1}{2}(\exp(x)+\exp(-x))$$
$H(x)=\dfrac{1}{4}\exp(x)^2\bigg(\exp(x)+\exp(-x)\bigg)^2=\dfrac{1}{4}e^{4x}+\dfrac{1}{2}e^{2x}+\dfrac{1}{4}$
常数项忽略，重新展开为指数生成函数，算得
$$[x^n]H(x)=2^{n-1}+4^{n-1}$$

[***AC 代码***](https://ac.nowcoder.com/acm/contest/view-submission?submissionId=78633079&returnHomeType=1&uid=379421591)

```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
using db = long double;
using i128 = __int128;

const int MOD=10007;
ll add(ll x, ll y) { return (x + y) % MOD; }
ll mul(ll x, ll y) { return (x * y) % MOD; }
ll qpow(ll a, ll b = MOD-2) {
    ll res = 1;
    for (; b; b>>=1) {
        if (b & 1) { res = mul(res, a); }
        a = mul(a, a);
    }
    return res;
}

void solve()
{
    int n;
    cin >> n;
    cout << add(qpow(2, n-1), qpow(4,n-1)) << "\n";
}

int main()
{
    ios::sync_with_stdio(0); cin.tie(0); cout.tie(0); 
    int t = 1;
    cin >> t;
    while (t--) { solve(); }
}

```
