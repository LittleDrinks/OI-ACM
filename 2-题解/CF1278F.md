---
tags:
  - 题解
  - 数学
aliases:
  - Cards
---
## [CF1278F. Cards](https://codeforces.com/problemset/problem/1278/F)

设 $x_i$ 表示第 $i$ 次抽到 Joker，则 $P(x_i)=\dfrac{(m-1)!}{m!}=\dfrac{1}{m}$，且
$$\displaystyle\mathbb{E}(x^k)=\mathbb{E}\left(\sum_{i=1}^{n}x_i\right)^k$$
根据期望的线性性把 $\displaystyle\left(\sum_{i=1}^{n}x_i\right)^k$ 展开，未合并前一共有 $n^k$ 项，即 $\displaystyle\sum_{i=1}^{n^k}\mathbb{E}A_i$。
对于每一项 $A_i=x_1^{c_1}x_2^{c_2}\cdots x_n^{c_n}$，它发生的概率取决于这一项种含有多少种不同的变量 $x_j$。
设 $col(A_i)$ 表示 $A_i$ 中不同变量的个数，则
$$
\mathbb{E}(x^k)=\sum_{c=1}^{\min(n,k)}\left(\frac{1}{m^c}\sum_{i=1}^{n^k}[col(A_i)=c]\right)
$$
我们考虑如何快速求出 $\displaystyle\sum_{i=1}^{n^k}[col(A_i)=c]$。

> [!note] 方法一
> 这个问题其实就是从 $n$ 个变量中取出 $c$ 个，再给 $k$ 个空位每个位置填一个变量。
> 先乘上 $\displaystyle{n\choose c}$，后续的问题其实就是将  $k$ 个不同的球放进 $c$ 个不同的盒子中，不允许空盒，方案数为 $c!\cdot s(k,c)$，其中 $s(k,c)$ 表示第二类 Stirling 数。
> 最终答案的式子为
> $$
> \mathbb{E}(x^k)=\sum_{c=1}^{\min(n,k)}\left(\frac{1}{m^c}P(n,c)s(k,c)\right)
> $$
> 由于 $k$ 比较小，$P(n,c)$ 可以 $O(k)$ 求出，第二类斯特林数可以 $O(k^2)$ 预处理。

> [!note] 方法二
> 这个系数的另一种求法是 DP，设 $f(k,c)=\displaystyle\sum_{i=1}^{n^k}[col(A_i)=c]$，则
> $$
> f(k,c)=(n-c+1)f(k-1,c-1)+cf(k-1,c-1)
> $$
> 时间复杂度 $O(k^2)$

[***AC 代码***](https://codeforces.com/contest/1278/submission/358027281)

```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;
using db = long double;
using i128 = __int128;

const int MOD = 998244353, N = 1e6 + 5;
template<class...T> ll add(T...t){ll r=0;(((r+=t%MOD)>=MOD?r-=MOD:0),...);return(r%MOD+MOD)%MOD;}
template<class...T> ll mul(T...t){ll r=1;((r=r*(t%MOD)%MOD),...);return(r%MOD+MOD)%MOD;}
ll del(ll x,ll y){return add(x,MOD-y);}
ll qpow(ll a,ll b=MOD-2){ll r=1;for(;b;b>>=1,a=mul(a,a))if(b&1)r=mul(r,a);return r;}
ll C(ll n, ll k) {ll res=qpow(k);for (ll i=n-k+1;i<=n;++i)res=mul(res,i);return res;}

void solve()
{
    int n, m, k;
    cin >> n >> m >> k;
    m = qpow(m);
    ll res = 0;
    vector s(k + 1, vector<int>(k + 1));
    s[0][0] = 1;
    for (int i = 1; i <= k; ++i) {
        for (int j = 1; j <= i; ++j) {
            s[i][j] = add(mul(n-j+1, s[i-1][j-1]), mul(j, s[i-1][j]));
        }
    }
    for (int i = 1, b = m; i <= k; ++i, b = mul(b, m)) {
        res = add(res, mul(s[k][i], b));
    }
    cout << res << "\n";
}

int main()
{
    ios::sync_with_stdio(0); cin.tie(0); cout.tie(0); 
    int t = 1;
    // cin >> t;
    while (t--) { solve(); }
}

```
